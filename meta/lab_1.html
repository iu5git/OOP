<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>lab_1</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html"><h1 id="создание-и-использование-статической-библиотеки----omit-in-toc---">1 - Создание и использование статической библиотеки <!-- omit in toc --></h1>
<blockquote>
<p>Лабораторная работа 1 для студентов курса “Программирование на основе классов и шаблонов” 2 семестра кафедры ИУ5 МГТУ им Н.Э. Баумана.</p>
</blockquote>
<h2 id="содержание----omit-in-toc---">Содержание <!-- omit in toc --></h2>
<ul>
<li><a href="#%D1%86%D0%B5%D0%BB%D1%8C-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B">Цель работы</a></li>
<li><a href="#%D0%BD%D0%B0%D1%87%D0%B0%D0%BB%D0%BE-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B">Начало работы</a></li>
<li><a href="#%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5">Задание</a>
<ul>
<li><a href="#%D0%BE%D1%81%D0%BD%D0%BE%D0%B2%D0%BD%D0%BE%D0%B5-%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5">Основное задание</a></li>
<li><a href="#%D0%B4%D0%BE%D0%BF%D0%BE%D0%BB%D0%BD%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B5-%D0%B7%D0%B0%D0%B4%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BF%D0%BE-%D0%B2%D0%B0%D1%80%D0%B8%D0%B0%D0%BD%D1%82%D0%B0%D0%BC">Дополнительные задания (по вариантам)</a></li>
</ul>
</li>
<li><a href="#%D0%BA%D0%B0%D0%BA-%D0%BD%D0%B0%D0%BF%D0%B8%D1%81%D0%B0%D1%82%D1%8C-%D1%81%D0%B2%D0%BE%D1%8E-%D0%B1%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA%D1%83">Как написать свою библиотеку</a>
<ul>
<li><a href="#%D0%BA%D0%BE%D1%80%D0%BE%D1%82%D0%BA%D0%BE">Коротко</a></li>
</ul>
</li>
<li><a href="#%D0%B8%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%B1%D0%B8%D0%B1%D0%BB%D0%B8%D0%BE%D1%82%D0%B5%D0%BA-%D1%81-cmake">Использование библиотек с CMake</a></li>
<li><a href="#%D1%82%D1%80%D0%B5%D0%B1%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D0%BA-%D0%BE%D1%82%D1%87%D1%91%D1%82%D1%83">Требования к отчёту</a></li>
<li><a href="#%D0%B2%D0%BE%D0%BF%D1%80%D0%BE%D1%81%D1%8B-%D0%B4%D0%BB%D1%8F-%D0%B7%D0%B0%D1%89%D0%B8%D1%82%D1%8B">Вопросы для защиты</a></li>
</ul>
<h2 id="цель-работы">Цель работы</h2>
<p>Целью лабораторной работы является формирование у студентов практических навыков проектирования и использования статических библиотек на языке программирования C++ с применением системы автоматизации сборки CMake, а также освоение принципов разработки кроссплатформенных программных приложений.</p>
<p>В ходе выполнения лабораторной работы студенты должны закрепить знания по модульной организации программного кода и компоновке программных проектов.</p>
<h2 id="начало-работы">Начало работы</h2>
<p>Зайдите в свою локальную директорию с репозиторием для выполнения лабораторных работ. Заберите ветку с соответствующей лабораторной работой из общего репозитория:</p>
<pre class=" language-sh"><code class="prism  language-sh">git pull upstream
</code></pre>
<p><strong>или</strong></p>
<pre class=" language-sh"><code class="prism  language-sh">git pull upstream lab_1
</code></pre>
<p>Переключитесь на ветку с текущей лабораторной работой:</p>
<pre class=" language-sh"><code class="prism  language-sh">git checkout lab_1
</code></pre>
<p>Свяжите ветку локального репозитория с вашим удаленным репозиторием:</p>
<pre class=" language-sh"><code class="prism  language-sh">git push --set-upstream origin lab_1
</code></pre>
<h2 id="задание">Задание</h2>
<h3 id="основное-задание">Основное задание</h3>
<p>В рамках лабораторной работы необходимо:</p>
<ul>
<li>
<p>Создать проект статической библиотеки с использованием системы сборки CMake.</p>
</li>
<li>
<p>Реализовать в библиотеке набор функций или класс, обеспечивающий заданную функциональность.</p>
</li>
<li>
<p>Создать консольное приложение на языке C++, использующее разработанную статическую библиотеку.</p>
</li>
<li>
<p>Подключить библиотеку к приложению и продемонстрировать корректность её работы.</p>
</li>
<li>
<p>Обеспечить возможность сборки и запуска проекта в операционных системах семейства Linux.</p>
</li>
</ul>
<h3 id="дополнительные-задания-по-вариантам">Дополнительные задания (по вариантам)</h3>
<p><em>Вариант 1</em><br>
Реализовать в библиотеке операции умножения и деления. Предусмотреть обработку деления на ноль.</p>
<p><em>Вариант 2</em><br>
Создать библиотеку утилит для обработки аргументов командной строки.</p>
<p><em>Вариант 3</em><br>
Реализовать в библиотеке функции для работы с массивом чисел (поиск минимального, максимального значения и вычисление среднего).</p>
<p><em>Вариант 4</em><br>
Добавить в библиотеку функцию возведения числа в степень без использования стандартных библиотечных функций.</p>
<p><em>Вариант 5</em><br>
Реализовать функции для генерации псевдослучайных чисел и заполнения ими массива.</p>
<p><em>Вариант 6</em><br>
Реализовать в библиотеке функции для вычисления факториала.</p>
<p><em>Вариант 7</em><br>
Создать библиотеку для работы со строками (конкатенация, определение длины строки) без использования стандартных библиотечных функций.</p>
<p><em>Вариант 8</em><br>
Реализовать в библиотеке функции для сортировки массива целых чисел.</p>
<p><em>Вариант 9</em><br>
Создать библиотеку для статистической обработки данных (среднее значение, медиана, дисперсия).</p>
<p><em>Вариант 10</em><br>
Добавить в библиотеку функции для поиска элемента в массиве (линейный поиск).</p>
<p><em>Вариант 11</em><br>
Реализовать библиотеку для работы с датами (сравнение дат, вычисление разницы между датами).</p>
<p><em>Вариант 12</em><br>
Создать библиотеку для работы с геометрическими фигурами (вычисление площади и периметра).</p>
<p><em>Вариант 13</em><br>
Реализовать функции для перевода целых чисел из одной системы счисления в другую.</p>
<p><em>Вариант 14</em><br>
Создать библиотеку утилит для обработки аргументов командной строки.</p>
<p><em>Вариант 15</em><br>
Реализовать библиотеку вспомогательных функций для работы с файлами (чтение и запись текстовых данных).</p>
<p><em>Вариант 16</em><br>
Добавить в библиотеку функции для вычисления наибольшего общего делителя и наименьшего общего кратного двух чисел.</p>
<p><em>Вариант 17</em><br>
Добавить в библиотеку функции для проверки числа на простоту и разложения числа на простые множители.</p>
<h2 id="как-написать-свою-библиотеку">Как написать свою библиотеку</h2>
<ol>
<li>Разделение кода</li>
</ol>
<p><em>Заголовочный файл (mylib.h).</em><br>
В нём объявления функций — что библиотека умеет:</p>
<pre class=" language-cpp"><code class="prism  language-cpp"><span class="token macro property">#<span class="token directive keyword">ifndef</span> MYLIB_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> MYLIB_H</span>

<span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span>
</code></pre>
<p><em>Файл реализации (mylib.cpp).</em><br>
Здесь реализация функций:</p>
<pre class=" language-cpp"><code class="prism  language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"mylib.h"</span></span>

<span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ol start="2">
<li>Создание статической библиотеки</li>
</ol>
<p><em>Компиляция в объектный файл:</em></p>
<pre class=" language-bash"><code class="prism  language-bash">g++ -c mylib.cpp
</code></pre>
<p>где флаг <code>-с</code>   только компилировать, но не линковать.</p>
<ul>
<li><code>g++</code> переводит <code>mylib.cpp</code> в объектный файл</li>
<li>на выходе получается файл <code>mylib.o</code></li>
<li>исполняемый файл НЕ создаётся</li>
</ul>
<p><em>Упаковка в статическую библиотеку:</em></p>
<pre class=" language-bash"><code class="prism  language-bash">ar rcs libmylib.a mylib.o
</code></pre>
<p><code>ar</code> (archiver) - инструмент для создания статических библиотек в Linux / Unix.</p>
<p>Файл libmylib.a — это статическая библиотека.</p>
<p><code>rcs</code>:</p>
<ul>
<li><strong>r</strong>eplace - добавить файл в архив, если такой файл уже есть —&gt; заменить</li>
<li><strong>c</strong>reate - создать архив, если его ещё нет (без этого флага <code>ar</code> всё равно создаст, но будет ворчать предупреждением)</li>
<li><strong>s</strong>ymbol index - создать индекс символов (таблицу функций) -&gt; нужен линковщику (ld), чтобы быстрее находить функции.</li>
</ul>
<p>итог</p>
<pre class=" language-cpp"><code class="prism  language-cpp">ar rcs libmylib<span class="token punctuation">.</span>a mylib<span class="token punctuation">.</span>o
</code></pre>
<ul>
<li>создаёт статическую библиотеку libmylib.a,</li>
<li>кладёт туда объектный файл mylib.o,</li>
<li>добавляет таблицу символов.</li>
</ul>
<p>Теперь libmylib.a — статическая библиотека.</p>
<ol start="3">
<li>Используем статическую библиотеку</li>
</ol>
<p><em>Файл программы (main.cpp)</em></p>
<pre class=" language-cpp"><code class="prism  language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"mylib.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><em>Компиляция программы:</em></p>
<pre class=" language-bash"><code class="prism  language-bash">g++ main.cpp -L. -lmylib -o app
</code></pre>
<p>где:</p>
<ul>
<li>имя файла: <strong>lib</strong><code>mylib</code>.a</li>
<li>ключ: <code>-l</code> + <code>mylib</code></li>
<li><code>-L.</code> где искать библиотеку: «ищи библиотеку в текущей папке»</li>
</ul>
<p>код библиотеки попадёт внутрь app, компоновщик сам выберет подходящий файл.</p>
<p>или принудительно</p>
<pre class=" language-bash"><code class="prism  language-bash">g++ main.cpp ./libmylib.a -o app
</code></pre>
<ol start="4">
<li>Создание динамической библиотеки</li>
</ol>
<p><em>Компиляция с поддержкой динамической загрузки:</em></p>
<pre class=" language-bash"><code class="prism  language-bash">g++ -fPIC -c mylib.cpp
</code></pre>
<p>где флаг <code>-fPIC</code> - <strong>P</strong>osition <strong>I</strong>ndependent <strong>C</strong>ode</p>
<ul>
<li>код генерируется так, чтобы его можно было загрузить по любому адресу в памяти</li>
<li>обязательно для динамических библиотек (.so)</li>
</ul>
<p>Почему это нужно:</p>
<ul>
<li><code>.so</code> может быть загружена в разные адреса разными процессами</li>
<li>без <sub>-fPIC</sub> линковщик либо ругнётся, либо библиотека будет работать медленно/криво</li>
</ul>
<p><em>Создание .so:</em></p>
<pre class=" language-bash"><code class="prism  language-bash">g++ -shared -o libmylib.so mylib.o
</code></pre>
<p>где флаг <code>-shared</code> указание линковщику -&gt; «собери shared library, а не исполняемый файл»</p>
<p>результат: <code>libmylib.so</code> это динамическая библиотека.</p>
<ol start="5">
<li>Использование динамической библиотеки</li>
</ol>
<p><em>Компиляция программы:</em></p>
<pre class=" language-bash"><code class="prism  language-bash">g++ main.cpp -L. -lmylib -o app
</code></pre>
<p>Флаги:</p>
<ul>
<li><code>-L.</code> — где искать библиотеки (текущая папка)</li>
<li><code>-lmylib</code> — ищет <code>libmylib.so</code> (сначала <code>.so</code>, потом <code>.a</code>)</li>
<li><code>-o app</code> — имя исполняемого файла.</li>
</ul>
<blockquote>
<p><em><strong>ВАЖНО</strong></em></p>
<p><em>На этапе компиляции библиотека должна быть найдена,<br>
но на этапе запуска — тоже</em>.</p>
</blockquote>
<p>Перед запуском:</p>
<pre class=" language-cpp"><code class="prism  language-cpp"><span class="token keyword">export</span> LD_LIBRARY_PATH<span class="token operator">=</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token operator">/</span>app
</code></pre>
<p><code>LD_LIBRARY_PATH</code> — список директорий, где динамический загрузчик ищет <code>.so</code> во время запуска.<br>
(или положить <code>.so</code> в стандартную папку)</p>
<h3 id="коротко">Коротко</h3>

<table>
<thead>
<tr>
<th>Флаг / переменная</th>
<th>Зачем</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-fPIC</code></td>
<td>Код можно загружать по любому адресу</td>
</tr>
<tr>
<td><code>-shared</code></td>
<td>Собрать <code>.so</code>, а не исполняемый файл</td>
</tr>
<tr>
<td><code>-L</code></td>
<td>Где искать библиотеки при линковке</td>
</tr>
<tr>
<td><code>-l</code></td>
<td>Какую библиотеку подключать</td>
</tr>
<tr>
<td><code>LD_LIBRARY_PATH</code></td>
<td>Где искать <code>.so</code> при запуске</td>
</tr>
</tbody>
</table><hr>
<h2 id="использование-библиотек-с-cmake">Использование библиотек с CMake</h2>
<p>Главная идея CMake:</p>
<p><em><strong>CMake не компилирует код сам.<br>
Он генерирует инструкции для компилятора:</strong></em></p>
<ul>
<li>«что собирать»,</li>
<li>«из каких файлов»,</li>
<li>«с какими библиотеками».</li>
</ul>
<pre class=" language-css"><code class="prism  language-css">project/
│
├── CMakeLists<span class="token number">.</span>txt
├── main<span class="token number">.</span>cpp
├── mylib<span class="token number">.</span>h
└── mylib<span class="token number">.</span>cpp
</code></pre>
<p><em>Самый простой CMakeLists.txt</em></p>
<pre class=" language-bash"><code class="prism  language-bash">cmake_minimum_required<span class="token punctuation">(</span>VERSION 3.10<span class="token punctuation">)</span>
project<span class="token punctuation">(</span>MyProject<span class="token punctuation">)</span>

<span class="token comment"># создаём библиотеку</span>
add_library<span class="token punctuation">(</span>mylib mylib.cpp<span class="token punctuation">)</span>

<span class="token comment"># создаём исполняемый файл</span>
add_executable<span class="token punctuation">(</span>app main.cpp<span class="token punctuation">)</span>

<span class="token comment"># связываем программу с библиотекой</span>
target_link_libraries<span class="token punctuation">(</span>app mylib<span class="token punctuation">)</span>
</code></pre>
<p><em>Сборка проекта</em></p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">mkdir</span> build
<span class="token function">cd</span> build
cmake <span class="token punctuation">..</span>
cmake --build <span class="token keyword">.</span>
</code></pre>
<p>Результат:</p>
<p>библиотека собирается автоматически</p>
<p>программа с ней связывается</p>
<p><em>Статическая или динамическая библиотека</em></p>
<p>По умолчанию CMake решает сам (обычно динамическая).</p>
<p>можно явно указать:<br>
<code>add_library(mylib STATIC mylib.cpp)</code>   - статическая<br>
<code>add_library(mylib SHARED mylib.cpp)</code>   - динамическая</p>
<p>Где тут -l и -L? - их нет.</p>
<p>CMake:</p>
<ul>
<li>сам знает, где лежит библиотека</li>
<li>сам подставляет -L и -l</li>
<li>сам следит за порядком линковки</li>
</ul>
<p><em>Как CMake понимает, какие .h подключать</em></p>
<p>Если заголовок рядом: <code>#include "mylib.h"</code>— всё работает автоматически.</p>
<p>Если в отдельной папке:<code>target_include_directories(mylib PUBLIC include)</code> путь, где лежат <code>.h</code> файлы библиотеки.</p>
<h2 id="требования-к-отчёту">Требования к отчёту</h2>
<p>Отчёт по лабораторной работе должен содержать:</p>
<ul>
<li>
<p>Титульный лист с указанием дисциплины, номера лабораторной работы, ФИО студента и группы.</p>
</li>
<li>
<p>Цель лабораторной работы.</p>
</li>
<li>
<p>Формулировку задания и номер варианта.</p>
</li>
<li>
<p>Краткие теоретические сведения по теме работы <em>(выполняются рукописно, разборчивым почерком, на отдельном листе бумаги)</em>.</p>
</li>
<li>
<p>Описание структуры проекта и используемых файлов.</p>
</li>
<li>
<p>Исходный код разработанной статической библиотеки и основного приложения.</p>
</li>
<li>
<p>Результаты выполнения программы (скриншоты или вывод в консоль).</p>
</li>
<li>
<p>Выводы по результатам выполненной работы.</p>
</li>
</ul>
<h2 id="вопросы-для-защиты">Вопросы для защиты</h2>
<ul>
<li>
<p>Что такое статическая библиотека и в чём её назначение?</p>
</li>
<li>
<p>В чём различие между статическими и динамическими библиотеками?</p>
</li>
<li>
<p>На каком этапе происходит подключение статической библиотеки к программе?</p>
</li>
<li>
<p>Назначение файлов заголовков в библиотеке.</p>
</li>
<li>
<p>Основные команды CMake для создания библиотек и исполняемых файлов.</p>
</li>
<li>
<p>Для чего используется команда target_link_libraries?</p>
</li>
<li>
<p>Преимущества и недостатки статических библиотек.</p>
</li>
<li>
<p>Что означает кроссплатформенность программного обеспечения?</p>
</li>
</ul>
</div>
</body>

</html>
